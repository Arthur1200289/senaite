<!-- Readonly Resultsinterpretation Field -->
<tal:readonly
  tal:define="fieldName string:ResultsInterpretationDepts"
  tal:condition="python:not view.is_edit_allowed()">

  <div class="arresultsinterpretation-container"
       tal:define="departments python:context.getDepartments()">

    <!-- Tabs for departments -->
    <ul class="nav nav-tabs">
      <li class="active">
        <a class="department-tab"
            href="#"
            tal:attributes="data-uid python:fieldName+'-general';"
            i18n:translate="">General</a>
      </li>
      <tal:depts repeat="dep departments">
        <li>
          <a class="department-tab"
              href="#"
              tal:attributes="data-uid python:fieldName+'-'+dep.UID();"
              tal:content="dep/Title"></a>
        </li>
      </tal:depts>
    </ul>

    <div class="department-area"
         tal:attributes="id python:fieldName+'-general';">
      <div tal:content="structure python:view.get_text(None, 'raw')"/>
    </div>

    <tal:department repeat="dept departments">
      <div class="department-area"
           tal:define="uid dept/UID"
           tal:attributes="id python:fieldName+'-'+uid;">
        <div tal:content="structure python:view.get_text(dept, 'raw')"></div>
      </div>
    </tal:department>

  </div>
</tal:readonly>


<!-- Editable Resultsinterpretation Field -->
<tal:edit
  tal:define="fieldName string:ResultsInterpretationDepts"
  tal:condition="python:view.is_edit_allowed()">

  <form class="form"
        name="arresultsinterpretation_form"
        action="."
        tal:attributes="action here/absolute_url"
        enctype="multipart/form-data"
        method="POST">

    <input type="hidden" name="submitted" value="1"/>
    <input tal:replace="structure context/@@authenticator/authenticator"/>

    <div class="arresultsinterpretation-container"
         tal:define="departments python:context.getDepartments()">
      <!-- Tabs for departments -->
      <ul class="nav nav-tabs" roles="tablist">
        <li class="nav-item">
          <a class="department-tab nav-link active"
             data-toggle="tab"
             href="#"
             role="tab"
             id="general"
             tal:attributes="href string:#${fieldName}-general;
                             data-uid string:${fieldName}-general;"
             i18n:translate="">General</a>
        </li>
        <tal:depts repeat="dep departments">
          <li class="nav-item">
            <a class="department-tab nav-link"
               data-toggle="tab"
               href="#"
               role="tab"
               tal:attributes="id dep/Title;
                               href string:#${fieldName}-${dep/UID};
                               data-uid python:fieldName+'-'+dep.UID();"
               tal:content="dep/Title"></a>
          </li>
        </tal:depts>
      </ul>

      <!-- TextAreas (RichText) for results interpretation -->
      <div class="tab-content">
        <div class="department-area tab-pane fade show active"
             role="tabpanel"
             tal:attributes="id string:${fieldName}-general;">
          <input type="hidden"
                 tal:attributes="name string:${fieldName}.uid:records:ignore_empty;
                                 id string:${fieldName}-uid-0;
                                 value string:general;"/>
          <textarea class="my-2 mce_editable"
                    tal:attributes="name string:${fieldName}.richtext:records:ignore_empty;
                                    id string:${fieldName}-richtext-0;"
                    tal:content="python: view.get_text(None, 'raw')">
          </textarea>
        </div>

        <tal:department repeat="dept departments">
          <div class="department-area tab-pane fade"
               role="tabpanel"
               tal:define="uid dept/UID"
               tal:attributes="id string:${fieldName}-${uid};">
            <input type="hidden"
                   tal:attributes="name string:${fieldName}.uid:records:ignore_empty;
                                   id string:${fieldName}-uid-${repeat/dept/number};
                                   value string:${uid};"/>
            <textarea class="my-2 mce_editable"
                      tal:attributes="name string:${fieldName}.richtext:records:ignore_empty;
                                      id string:${fieldName}-richtext-${repeat/dept/number};"
                      tal:content="python:view.get_text(dept, 'raw')">
            </textarea>
          </div>
        </tal:department>
      </div>
    </div>
    <button type="submit" class="btn btn-outline-primary btn-sm" i18n:translate="">Save</button>
  </form>
</tal:edit>
